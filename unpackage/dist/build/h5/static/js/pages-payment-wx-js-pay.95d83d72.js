(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-payment-wx-js-pay"],{"429c":function(e,t,n){var r=n("c99c");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var a=n("4f06").default;a("b535d812",r,!0,{sourceMap:!1,shadowMode:!1})},"5d4a":function(e,t,n){"use strict";var r=n("ee27");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("96cf");var a=r(n("c964")),i=r(n("ca07")),o={getNetPayOrderAsync:function(e){return(0,a.default)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,i.default.get("/payment/GetNetPayOrderAsync?listNo=".concat(e));case 2:return n=t.sent,t.abrupt("return",n.result);case 4:case"end":return t.stop()}}),t)})))()},jsApiPayAsync:function(e){return(0,a.default)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,i.default.post("/payment/JsApiPayAsync?listNo=".concat(e));case 2:return n=t.sent,t.abrupt("return",n.result);case 4:case"end":return t.stop()}}),t)})))()},miniProgramPayAsync:function(e){return(0,a.default)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,i.default.post("/payment/MiniprogramPayAsync?listNo=".concat(e));case 2:return n=t.sent,t.abrupt("return",n.result);case 4:case"end":return t.stop()}}),t)})))()}};t.default=o},8714:function(e,t,n){"use strict";n.r(t);var r=n("c9a4"),a=n("9b90");for(var i in a)"default"!==i&&function(e){n.d(t,e,(function(){return a[e]}))}(i);n("ca92");var o,u=n("f0c5"),c=Object(u["a"])(a["default"],r["b"],r["c"],!1,null,"88737054",null,!1,r["a"],o);t["default"]=c.exports},"9b90":function(e,t,n){"use strict";n.r(t);var r=n("f67a"),a=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,(function(){return r[e]}))}(i);t["default"]=a.a},c4f4:function(e,t,n){"use strict";var r=n("ee27");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("96cf");var a=r(n("c964")),i=r(n("ca07")),o={logError:function(e){return(0,a.default)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return"object"==typeof e&&(e=JSON.stringify(e)),t.next=3,i.default.post("/common/LogError?message=".concat(e));case 3:case"end":return t.stop()}}),t)})))()},getEducationComboboxItems:function(){return(0,a.default)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,i.default.get("/common/GetEducationComboboxItems");case 2:return t=e.sent,e.abrupt("return",t.result);case 4:case"end":return e.stop()}}),e)})))()},getNationComboboxItems:function(){return(0,a.default)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,i.default.get("/common/GetNationComboboxItems");case 2:return t=e.sent,e.abrupt("return",t.result);case 4:case"end":return e.stop()}}),e)})))()},getAgeRangeComboboxItemsAsync:function(){return(0,a.default)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,i.default.get("/common/GetAgeRangeComboboxItemsAsync");case 2:return t=e.sent,e.abrupt("return",t.result);case 4:case"end":return e.stop()}}),e)})))()},getTouristOriginTreeAsync:function(){return(0,a.default)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,i.default.get("/common/GetTouristOriginTreeAsync");case 2:return t=e.sent,e.abrupt("return",t.result);case 4:case"end":return e.stop()}}),e)})))()}};t.default=o},c99c:function(e,t,n){var r=n("24fb");t=r(!1),t.push([e.i,'@charset "UTF-8";\r\n/**\r\n * scss预处理 内置的常用样式变量\r\n * 后期项目会考虑使用scss\r\n*/\r\n/* 颜色变量 */\r\n/* 行为相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */.in-order[data-v-88737054]{background-color:#fff;text-align:center;padding:15px 15px}.in-order-countdown[data-v-88737054]{font-size:13px;color:#999;line-height:1}.in-order-fee[data-v-88737054]{margin-top:10px;line-height:1;font-size:30px;letter-spacing:-.44px}.in-order-fee-text[data-v-88737054]{font-size:20px;margin-right:8px}.in-order-fee uni-text[data-v-88737054]{font-weight:700}.in-order-title[data-v-88737054]{margin-top:3px;font-size:11px;color:#999}.in-pay-method[data-v-88737054]{margin:15px 0;background-color:#fff}.in-pay-method-pay-type[data-v-88737054]{padding:0 20px;height:70px;line-height:70px;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.in-pay-method-pay-type uni-view[data-v-88737054]{vertical-align:middle;font-size:25px;margin-right:20px;color:#09bb07}.in-pay-method-pay-type uni-text[data-v-88737054]{display:inline-block;vertical-align:middle;font-size:18px;font-weight:600}.in-button[data-v-88737054]{padding:0 15px}.in-button uni-button[data-v-88737054]{border-radius:5px;height:50px;line-height:39px;font-size:16px;background:#19a0f0}',""]),e.exports=t},c9a4:function(e,t,n){"use strict";var r,a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",[n("v-uni-view",{staticClass:"in-order"},[n("v-uni-view",{staticClass:"in-order-countdown"},[e._v("支付剩余时间"),n("v-uni-text",[e._v(e._s(e.countdownText))])],1),n("v-uni-view",{staticClass:"in-order-fee"},[n("v-uni-text",{staticClass:"in-order-fee-text"},[e._v("¥")]),n("v-uni-text",[e._v(e._s(e.totalMoney))])],1),n("v-uni-view",{staticClass:"in-order-title"},[e._v(e._s(e.product))])],1),n("v-uni-view",{staticClass:"in-pay-method"},[n("v-uni-view",{staticClass:"in-pay-method-pay-type"},[n("v-uni-view",{staticClass:"iconfont icon-weixin"}),n("v-uni-text",[e._v("微信支付")])],1)],1),n("v-uni-view",{staticClass:"in-button"},[n("v-uni-button",{attrs:{type:"primary",size:"large",loading:e.saving},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.pay.apply(void 0,arguments)}}},[e._v("确认支付")])],1)],1)},i=[];n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return r}))},ca92:function(e,t,n){"use strict";var r=n("429c"),a=n.n(r);a.a},ce67:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={noneToast:function(e){uni.showToast({title:e,icon:"none"})}};t.default=r},f67a:function(e,t,n){"use strict";var r=n("ee27");n("ac1f"),n("5319"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("96cf");var a=r(n("c964")),i=r(n("c06e")),o=r(n("5d4a")),u=r(n("c4f4")),c=r(n("e47f")),s=(r(n("ce67")),{data:function(){return{countdownText:"",totalMoney:0,timer:-1,queryTimer:-1,saving:!1,shouldConfirm:!0,listNo:""}},computed:{product:function(){return uni.getStorageSync("Pay:Product")}},onLoad:function(e){var t=this;return(0,a.default)(regeneratorRuntime.mark((function n(){var r,a,u,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,t.listNo=e.listNo,n.next=4,o.default.getNetPayOrderAsync(t.listNo);case 4:if(r=n.sent,t.totalMoney=r.payMoney,!(r.expireSeconds<=0)){n.next=11;break}return t.shouldConfirm=!1,t.$router.push({name:"tickettype"}),uni.showTabBar({url:"/pages/index/index"}),n.abrupt("return");case 11:a=(0,i.default)("2018-01-01 00:00:00"),u=a.clone().addSeconds(r.expireSeconds),c=r.expireSeconds>3600?"HH:mm:ss":"mm:ss",t.countdownText=u.format(c),t.timer=setInterval((function(){u=u.addSeconds(-1),t.countdownText=u.format(c),u.isSame(a)&&o.default.getNetPayOrderAsync(t.listNo).then((function(e){t.clear(),t.shouldConfirm=!1,e.paySuccess?uni.redirectTo({url:"/pages/order/order-detail?listNo="+t.listNo}):t.$dialog.alert({title:"支付超时订单已取消"}).then((function(){uni.redirectTo({url:"/pages/index/index"})}))}))}),1e3),n.next=21;break;case 18:n.prev=18,n.t0=n["catch"](0),console.log(n.t0);case 21:case"end":return n.stop()}}),n,null,[[0,18]])})))()},onHide:function(e,t,n){var r=this;if(console.log(e),console.log(t),console.log(n),!this.shouldConfirm||e.meta.shouldNotConfirm)return this.clear(),void n();this.$dialog.confirm({title:"你的支付尚未完成，是否取消支付？",showCancelButton:!0,confirmButtonText:"继续支付",cancelButtonText:"取消支付"}).then((function(){n(!1)})).catch((function(){r.clear(),r.shouldConfirm=!1,n({name:"orderdetail",params:{listNo:r.listNo},replace:!0})}))},methods:{pay:function(){var e=this;return(0,a.default)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e.saving=!0,t.next=4,o.default.jsApiPayAsync(e.listNo);case 4:return n=t.sent,t.next=7,c.default.jsApiPay(n);case 7:console.log(n),uni.showLoading({title:"查询支付结果..."}),e.queryTimer=setInterval((function(){o.default.getNetPayOrderAsync(e.listNo).then((function(t){t.paySuccess&&(e.clear(),e.shouldConfirm=!1,e.$router.replace({name:"orderdetail",params:{listNo:e.listNo}}))}))}),3e3),t.next=17;break;case 12:if(t.prev=12,t.t0=t["catch"](0),"get_brand_wcpay_request:cancel"!=t.t0.err_msg){t.next=16;break}return t.abrupt("return");case 16:u.default.logError(t.t0);case 17:return t.prev=17,e.saving=!1,t.finish(17);case 20:case"end":return t.stop()}}),t,null,[[0,12,17,20]])})))()},clear:function(){clearInterval(this.timer),clearInterval(this.queryTimer)}}});t.default=s}}]);